<app-toolbar-form
  [header]="viewOnly ? 'View Client' : editMode ? 'Edit Client' : 'Add Client'"
  [backExists]="true"
  [backIcon]="'back-icon'"
  [viewOnly]="false"
  [selectedAction]="selectedAction"
  [workFlowItems]="workFlowActionList"
  (saveAction)="handleWorkflowAction($event)"
></app-toolbar-form>

<p-tabs [value]="tabValue" styleClass="p-3">
  <p-tablist>
    <p-tab [value]="0" [disabled]="disableCompanyTab">
      {{ "CLIENT.COMPANY" | translate }}
    </p-tab>

    <p-tab [value]="1" [disabled]="disableIndividualTab">
      {{ "CLIENT.INDIVIDUAL" | translate }}
    </p-tab>
  </p-tablist>

  <p-tabpanels>
    <p-tabpanel [value]="0">
      <p-stepper [value]="1" class="basis-[50rem] mb-2">
        <p-step-panels>
          <!-- Step 1: Main Info -->
          <p-step-panel [value]="1">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="flex flex-col">
                <app-add-client-form
                  [formGroup]="addClientForm"
                  [description]="''"
                  [addClientShowMain]="true"
                  [addClient]="true"
                  [sectorsList]="sectorsList"
                  [subSectorsList]="subSectorsList"
                  [selectedSectorId]="selectedSectorId"
                  [selectedSubSectorId]="selectedSubSectorId"
                  (sectorChanged)="onSectorChanged($event)"
                  [viewOnly]="viewOnly && tabValue === 0"
                ></app-add-client-form>
                <div
                  class="col-sm-6 d-flex justify-end float-right margin-top p-0 w-100"
                >
                  <p-button
                    class="custom-save m-0"
                    [label]="'BUTTONS.NEXT' | translate"
                    (click)="activateCallback(2)"
                  ></p-button>
                </div>
              </div>
            </ng-template>
          </p-step-panel>

          <!-- Step 2: Legal Info -->
          <p-step-panel [value]="2">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="flex flex-col">
                <app-add-client-form
                  [formGroup]="addClientForm"
                  [title]="'CLIENT_FORM.LEGAL_INFORMATION.TITLE' | translate"
                  [description]="
                    'CLIENT_FORM.LEGAL_INFORMATION.DESCRIPTION' | translate
                  "
                  [addClientShowLegal]="true"
                  [addClient]="true"
                  [viewOnly]="viewOnly && tabValue === 0"
                ></app-add-client-form>

                <div class="row two-buttons margin-top">
                  <div class="col-sm-6">
                    <p-button
                      [label]="'BUTTONS.PREVIOUS' | translate"
                      class="custom-back"
                      (click)="activateCallback(1)"
                    ></p-button>
                  </div>
                  <div class="col-sm-6 m-0">
                    <p-button
                      [label]="'BUTTONS.NEXT' | translate"
                      (click)="activateCallback(3)"
                      class="custom-save m-0 float-right"
                    ></p-button>
                  </div>
                </div>
              </div>
            </ng-template>
          </p-step-panel>

          <!-- Step 3: Business Info -->
          <p-step-panel [value]="3">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="flex flex-col">
                <app-add-client-form
                  [formGroup]="addClientForm"
                  [title]="'CLIENT_FORM.BUSINESS_INFORMATION.TITLE' | translate"
                  [description]="
                    'CLIENT_FORM.BUSINESS_INFORMATION.DESCRIPTION' | translate
                  "
                  [addClientShowBusiness]="true"
                  [addClient]="true"
                  [viewOnly]="viewOnly && tabValue === 0"
                ></app-add-client-form>

                <div class="row two-buttons margin-top">
                  <div class="col-sm-6">
                    <p-button
                      [label]="'BUTTONS.PREVIOUS' | translate"
                      (click)="activateCallback(2)"
                      class="custom-back d-flex justify-start"
                    ></p-button>
                  </div>
                  <div class="col-sm-6 m-0">
                    <p-button
                      *ngIf="!viewOnly"
                      [label]="'BUTTONS.SAVE_INFO' | translate"
                      [disabled]="this.addClientForm.invalid"
                      (click)="saveInfo()"
                      class="custom-save2 m-0 float-right"
                    ></p-button>
                    <p-button
                      *ngIf="viewOnly"
                      (click)="close()"
                      label="Close"
                      class="custom-save m-0 float-right"
                    ></p-button>
                  </div>
                </div>
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-panels>
      </p-stepper>
    </p-tabpanel>

    <!-- Individual Tab -->
    <p-tabpanel [value]="1">
      <app-add-client-form
        [formGroup]="addClientFormIndividual"
        [description]="
          'CLIENT_FORM.INDIVIDUAL_CORE_INFO.DESCRIPTION' | translate
        "
        [addClientShowIndividual]="true"
        [addClient]="true"
        [sectorsList]="sectorsList"
        [subSectorsList]="subSectorsList"
        [selectedSectorId]="selectedSectorId"
        (sectorChanged)="onSectorChanged($event)"
        (removeIdentity)="removeIdentity($event)"
        (addIdentity)="addIdentity()"
        [identityIndividual]="identityOptions"
        [viewOnly]="viewOnly && tabValue === 1"
        [editMode]="editMode"
      ></app-add-client-form>

      <div class="row justify-end">
        <div class="col-sm-12 col-md-6 d-flex justify-end margin-top">
          <p-button
            *ngIf="!viewOnly"
            (click)="saveInfoIndividual()"
            [label]="'BUTTONS.SAVE_INFO' | translate"
            [disabled]="this.addClientFormIndividual.invalid"
            class="custom-save m-0 float-right"
          ></p-button>
          <p-button
            *ngIf="viewOnly"
            (click)="close()"
            label="Close"
            class="custom-save m-0 float-right"
          ></p-button>
        </div>
      </div>
    </p-tabpanel>
  </p-tabpanels>
</p-tabs>

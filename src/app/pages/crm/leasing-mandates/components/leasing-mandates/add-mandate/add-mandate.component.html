<!-- Bring in Bootstrap 4 (or your global bundle) -->

<form [formGroup]="parentForm" (ngSubmit)="onSubmit()" class="zoom">
  <!-- Progress bar -->
  <div class="step-progress mb-4">
    <div
      class="step-progress__thumb"
      [style.width.%]="segmentWidth"
      [style.left.%]="thumbLeft"
    ></div>
  </div>
  <!-- Step indicators (discrete "stepper" look) -->
  <div class="mb-3">
    <ul class="stepper d-flex justify-content-between list-unstyled px-1">
      <li
        *ngFor="let s of steps"
        [class.active]="s <= currentStep"
        class="text-center flex-fill"
      >
        <!-- <div class="circle mx-auto">{{ s }}</div> -->
        <p class="d-block">
          {{ stepTitles[s - 1] }}
        </p>
      </li>
    </ul>
  </div>
  <!-- STEP 1: Basic -->
  <div *ngIf="currentStep === 1">
    <app-form
      [title]="'MANDATE.BASIC_INFO.TITLE'"
      [description]="'MANDATE.BASIC_INFO.DESCRIPTION'"
      [addMandateShowBasicForm]="true"
      [formGroup]="addMandateShowBasicForm"
      [show]="show"
      [editShow]="editShow"
      [editMode]="editMode"
      [viewOnly]="viewOnly"
      [clientNames]="clientNames$ | async"
      [leasingTypes]="leasingTypes$ | async"
      [insuredBy]="insuredBy$ | async"
    ></app-form>
  </div>

  <!-- STEP 2: Asset Types -->
  <div *ngIf="currentStep === 2">
    <app-form
      [title]="'MANDATE.ASSET_TYPE.TITLE'"
      [description]="'MANDATE.ASSET_TYPE.DESCRIPTION'"
      [addMandateShowAssetTypeForm]="true"
      [formGroup]="assetsForm"
      [editMode]="editMode"
      [viewOnly]="viewOnly"
      [assetTypesList]="assetTypes$ | async"
      (removeAssetType)="removeAssetType($event)"
      (addAssetType)="addAssetType()"
    ></app-form>
  </div>

  <!-- STEP 3: Fees -->
  <div *ngIf="currentStep === 3">
    <app-form
      [title]="'FORM.MANDATE.FEES'"
      [description]="'FORM.MANDATE.FEES_DESCRIPTION'"
      [addMandateShowFeeForm]="true"
      [feeTypes]="feeTypes$ | async"
      [formGroup]="addMandateShowFeeForm"
      [editMode]="editMode"
      [viewOnly]="viewOnly"
      (removeFee)="removeFee($event)"
      (addFee)="addFee()"
    ></app-form>
  </div>

  <!-- STEP 4: Financial Activities  -->
  <div *ngIf="currentStep === 4">
    <app-form
      [title]="'FORM.MANDATE.FINANCIAL_ACTIVITIES.TITLE'"
      [description]="'FORM.MANDATE.FINANCIAL_ACTIVITIES.DESCRIPTION'"
      [addMandateShowFinancialActivityForm]="true"
      [formGroup]="addMandateShowFinancialActivityForm"
      [paymentPeriods]="paymentPeriods$ | async"
      [currencies]="currencies$ | async"
      [currencyExchangeRates]="currencyExchangeRates$ | async"
      [interestRateBenchMarks]="interestRateBenchmarks$ | async"
      [paymentTimingTerms]="paymentTimingTerms$ | async"
      [rentStructureTypes]="rentStructureTypes$ | async"
      [paymentMethods]="paymentMethods$ | async"
      [paymentMonthDays]="paymentMonthDays$ | async"
      [editMode]="editMode"
      [viewOnly]="viewOnly"
    ></app-form>
  </div>

  <!-- Navigation -->
  <div
    class="d-flex mt-4"
    [ngClass]="{
      'justify-content-end': currentStep === 1,
      'justify-content-between': currentStep > 1
    }"
  >
    <button
      type="button"
      class="btn btn-outline-primary"
      (click)="previous()"
      [hidden]="currentStep === 1"
    >
      Back
    </button>

    <!-- Next (hidden on last step) -->
    <button
      type="button"
      class="btn btn-primary mr-2"
      (click)="next()"
      *ngIf="currentStep < totalSteps"
      [disabled]="viewOnly"
    >
      Next
    </button>

    <!-- Submit (only on last step, and not view-only) -->
    <button
      type="submit"
      class="btn btn-success"
      *ngIf="currentStep === totalSteps && !viewOnly"
      (click)="onSubmit()"
    >
      {{ editMode ? "Edit Mandate" : "Add Mandate" }}
    </button>

    <!-- Close (only on last step, view-only) -->
    <button
      type="button"
      class="btn btn-secondary"
      *ngIf="currentStep === totalSteps && viewOnly"
      (click)="navigateToView()"
    >
      Close
    </button>
  </div>
</form>

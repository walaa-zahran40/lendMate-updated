<app-toolbar-form
  [header]="viewOnly ? 'View Asset' : editMode ? 'Edit Asset' : 'Add Asset'"
  [backExists]="true"
  [backIcon]="'back-icon'"
  [viewOnly]="viewOnly"
></app-toolbar-form>

<p-tabs styleClass="p-3">
  <p-tabpanels>
    <p-tabpanel>
      <p-stepper [value]="1" class="basis-[50rem] mb-2">
        <p-step-panels>
          <!-- Step 1: General Info -->
          <p-step-panel [value]="1">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="flex flex-col">
                <app-add-asset-form
                  [formGroup]="addAssetForm"
                  [description]="'FORM.ASSETS.DESCRIPTION'"
                  [addAssetShowMain]="true"
                  *ngIf="addAssetForm"
                  [assetTypes]="assetTypes$ | async"
                  [viewOnly]="viewOnly"
                ></app-add-asset-form>
                <div
                  class="col-sm-6 d-flex justify-end float-right margin-top p-0 w-100"
                >
                  <p-button
                    *ngIf="viewOnly"
                    class="custom-save m-0"
                    label="Close"
                    (click)="close()"
                  >
                  </p-button>

                  <p-button
                    *ngIf="!viewOnly && needsSecondStep"
                    class="custom-save m-0"
                    [label]="'BUTTONS.NEXT' | translate"
                    (click)="activateCallback(2)"
                  ></p-button>
                  <!-- Save right away when there is NO step 2 (Property) -->
                  <p-button
                    *ngIf="!viewOnly && !needsSecondStep"
                    class="custom-save m-0"
                    [label]="'BUTTONS.SAVE_INFO' | translate"
                    [disabled]="addAssetForm.invalid"
                    (click)="saveInfo()"
                  >
                  </p-button>
                </div>
              </div>
            </ng-template>
          </p-step-panel>

          <!-- Step 2 -->
          <p-step-panel [value]="2" *ngIf="needsSecondStep">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="flex flex-col">
                <ng-container [ngSwitch]="selectedAssetTypeForm">
                  <app-add-vehicle-form
                    *ngSwitchCase="'vehicle'"
                    [formGroup]="addVehicleForm"
                    [title]="'FORM.VEHICLES.TITLE'"
                    [description]="'FORM.VEHICLES.DESCRIPTION'"
                    [addAssetShowInfo]="true"
                    [vehicleManufacturers]="vehicleManufacturers$ | async"
                    [vehicleModels]="vehicleModels$ | async"
                    [viewOnly]="viewOnly"
                  ></app-add-vehicle-form>

                  <app-add-equipment-form
                    *ngSwitchCase="'equipment'"
                    [formGroup]="addEquipmentForm"
                    [addAssetShowInfo]="true"
                    [viewOnly]="viewOnly"
                  ></app-add-equipment-form>

                  <div *ngSwitchDefault class="p-error">
                    No form available for the selected asset type.
                  </div>
                </ng-container>
                <div class="row two-buttons margin-top">
                  <div class="col-sm-6">
                    <p-button
                      [label]="'BUTTONS.PREVIOUS' | translate"
                      class="custom-back"
                      (click)="activateCallback(1)"
                    ></p-button>
                  </div>
                  <div class="col-sm-6 m-0">
                    <p-button
                      *ngIf="!viewOnly"
                      [label]="'BUTTONS.SAVE_INFO' | translate"
                      [disabled]="
                        addAssetForm.invalid ||
                        (selectedAssetTypeForm === 'vehicle' &&
                          addVehicleForm.invalid) ||
                        (selectedAssetTypeForm === 'equipment' &&
                          addEquipmentForm.invalid)
                      "
                      (click)="saveInfo()"
                      class="custom-save2 m-0 float-right"
                    ></p-button>
                    <p-button
                      *ngIf="viewOnly"
                      (click)="close()"
                      label="Close"
                      class="custom-save m-0 float-right"
                    ></p-button>
                  </div>
                </div>
              </div>
            </ng-template>
          </p-step-panel>
        </p-step-panels>
      </p-stepper>
    </p-tabpanel>
  </p-tabpanels>
</p-tabs>
